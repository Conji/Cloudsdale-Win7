<Page x:Class="Cloudsdale_Win7.CloudView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:MVVM="clr-namespace:Cloudsdale_Win7.MVVM" xmlns:Controls="clr-namespace:Cloudsdale_Win7.Controls"
      xmlns:System="clr-namespace:System;assembly=mscorlib" mc:Ignorable="d" 
      d:DesignHeight="564.045" d:DesignWidth="819.101" Foreground="White"
	Title="CloudView">

    <Page.Resources>
        <MVVM:StatusConverter x:Key="StatusConverter"/>
        <MVVM:DependencyJToken x:Key="Cloud" />
    </Page.Resources>

    <Grid Background="#FFFAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="131" />
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <StackPanel Orientation="Horizontal" CanHorizontallyScroll="True" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Disabled" ScrollViewer.CanContentScroll="True" Grid.ColumnSpan="2" Height="47" VerticalAlignment="Top">
            <StackPanel.Background>
                <SolidColorBrush Color="{DynamicResource PrimaryBlue}"/>
            </StackPanel.Background>
            <StackPanel Width="434">
                <StackPanel Orientation="Horizontal">
                    <StackPanel x:Name="RateSliderContainer" Margin="2">
                        <TextBlock x:Name="RateSliderLabel"  Text="{Binding Rate}" />
                    </StackPanel>
                    <StackPanel x:Name="MaxCharContainer" Margin="2"/>
                    <StackPanel Margin="2">
                        <TextBlock/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
            <Button x:Name="acp" Content="Owner Control Panel" FontFamily="Aharoni" Width="141" Margin="0,10"/>
            <Rectangle Fill="#FFF4F4F5" Stroke="Black" Width="360" Margin="20,57,20,62" Visibility="Hidden"/>
        </StackPanel>
        <ScrollViewer x:Name="ChatScroll" Grid.ColumnSpan="2" Margin="0,47,0,0" Grid.RowSpan="2">
            <ItemsControl x:Name="ChatMessages">
                <ItemsControl.Background>
                    <SolidColorBrush Color="{DynamicResource PrimaryBackground}"/>
                </ItemsControl.Background>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Separator VerticalAlignment="Top" Opacity=".5" />
                            <Grid Visibility="{Binding [orgcontent], ConverterParameter=Inverse, Converter={StaticResource SlashMe}}"
                                  Margin="4,6,4,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Margin="3">
                                    <Image Source="{Binding [author][avatar][preview], Converter={StaticResource StringUriConv}}" 
                                           Width="60" Height="60"
                                           Cursor="Hand"/>
                                    <Border Background="{Binding [author][role], Converter={StaticResource TagColor}}"
                                            Visibility="{Binding [author][role], Converter={StaticResource HCT}}"
                                            Width="60" Margin="0,1">
                                        <TextBlock Text="{Binding [author][role], Converter={StaticResource RoleTag}}" 
                                                   FontSize="12" FontWeight="Bold"  Foreground="White" HorizontalAlignment="Center" />
                                    </Border>
                                </StackPanel>
                                <TextBlock Margin="5" FontSize="18" Cursor="Hand" Grid.Column="1" VerticalAlignment="Top" Foreground="DarkSlateGray"><Run Text="{Binding [author][name], Converter={StaticResource JTSC}}" Foreground="{Binding [author], ConverterParameter={StaticResource Cloud}, Converter={StaticResource NameColor}}" /><Run Text=" (@"/><Run Text="{Binding [author][username], Converter={StaticResource JTSC}}" Foreground="{Binding [author][status], Converter={StaticResource StatusConverter}}"/><Run Text=")"/><LineBreak/><InlineUIContainer>
                                        <ItemsControl ItemsSource="{Binding [content], Converter={StaticResource SLSC}}">
                                            <ItemsControl.ItemTemplate> 
                                                <DataTemplate>
                                                    <Grid>
                                                        <Controls:LinkDetectingTextBlock TextWrapping="Wrap"
                                                                   Foreground="{Binding Converter={StaticResource ChatColor}}" LinkedText="{Binding}"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </InlineUIContainer></TextBlock>
                                <StackPanel Grid.Column="2">
                                    <TextBlock FontSize="16" HorizontalAlignment="Right" Foreground="Black"><Run Text="{Binding [timestamp], Converter={StaticResource TDTS}}" /><Run Text=" "/><Run Text="{Binding [device], Converter={StaticResource DeviceIcon}}" /></TextBlock>
                                    <ItemsControl ItemsSource="{Binding [drops]}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel MaxWidth="500" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderBrush="DarkGray" BorderThickness="3" Margin="10">
                                                    <Image Width="120" Height="90" Cursor="Hand" MouseUp="DropUp"
                                                       Source="{Binding [preview], Converter={StaticResource StringUriConv}}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Grid>
                            <StackPanel Visibility="{Binding [orgcontent], Converter={StaticResource SlashMe}}" Margin="5">
                                <Grid>
                                    <TextBlock Text="{Binding [timestamp], Converter={StaticResource TDTS}}" 
                                               FontSize="14" HorizontalAlignment="Center" Foreground="Black" />
                                    <TextBlock Text="{Binding [device], Converter={StaticResource DeviceIcon}}"
                                               FontSize="14" HorizontalAlignment="Right" Foreground="Black" />
                                </Grid>
                                <TextBlock Text="{Binding [content], Converter={StaticResource JTSC}}" 
                                           FontSize="18" HorizontalAlignment="Center" Margin="0,0,0,10" Foreground="Black"
                                           TextWrapping="Wrap" FontFamily="Pfennig"/>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <Controls:LinkDetectingTextBlock TextWrapping="Wrap" Text="LinkDetectingTextBlock"/>
            </ItemsControl>
        </ScrollViewer>
        <TextBox Grid.Row="2" x:Name="InputBox" FontSize="18" KeyDown="SendBoxEnter" Grid.ColumnSpan="2" SpellCheck.IsEnabled="True" />
        <Expander Header="Menu" FontSize="14" Height="121" VerticalAlignment="Top" Grid.Column="1" HorizontalAlignment="Right" Width="468" Grid.RowSpan="2" ExpandDirection="Left">
            <Grid Margin="0,0,0,-2" Background="#FF3F85B3">
                <Image Margin="30,10,0,21" HorizontalAlignment="Left" Width="52" Cursor="Hand" Source="/Cloudsdale;component/Assets/cloud.png"/>
                <TextBlock TextWrapping="Wrap" Text="Explore" Margin="30,65,327,0" FontSize="18" Height="22" VerticalAlignment="Top" FontWeight="Bold">
                    <TextBlock.Foreground>
                        <SolidColorBrush Color="{DynamicResource PrimaryContent}"/>
                    </TextBlock.Foreground>
                </TextBlock>
                <Image Margin="133,10,0,21" HorizontalAlignment="Left" Width="52" Cursor="Hand" MouseDown="DirectHome" Source="/Cloudsdale;component/Assets/home.png"/>
                <TextBlock TextWrapping="Wrap" Text="Home" Margin="140,65,233,0" FontSize="18" Height="22" VerticalAlignment="Top" FontWeight="Bold">
                    <TextBlock.Foreground>
                        <SolidColorBrush Color="{DynamicResource PrimaryContent}"/>
                    </TextBlock.Foreground>
                </TextBlock>
                <Image Margin="253,10,0,21" HorizontalAlignment="Left" Width="52" Cursor="Hand" MouseDown="ShowSettings" Source="/Cloudsdale;component/Assets/computer_service.png"/>
                <TextBlock TextWrapping="Wrap" Text="Settings" Margin="253,65,102,0" FontSize="18" Height="22" VerticalAlignment="Top" FontWeight="Bold">
                    <TextBlock.Foreground>
                        <SolidColorBrush Color="{DynamicResource PrimaryContent}"/>
                    </TextBlock.Foreground>
                </TextBlock>
                <Image Margin="356,10,0,21" HorizontalAlignment="Left" Width="52" Cursor="Hand" Source="/Cloudsdale;component/Assets/circle_info.png"/>
                <TextBlock TextWrapping="Wrap" Text="Info" Margin="367,65,19,0" FontSize="18" Height="22" VerticalAlignment="Top" FontWeight="Bold">
                    <TextBlock.Foreground>
                        <SolidColorBrush Color="{DynamicResource PrimaryContent}"/>
                    </TextBlock.Foreground>
                </TextBlock>
            </Grid>
        </Expander>
        <TextBlock VerticalAlignment="Top" FontSize="16" Margin="10,10,468,0" Text="{Binding [name]}" Height="37" FontFamily="Segoe UI Semibold" Grid.ColumnSpan="2"/>
    </Grid>
</Page>
